<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±ØµØ¯ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ 2025 - Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙŠØ© ÙˆØ­Ù„ÙˆÙ„ Ù…Ø¨ØªÙƒØ±Ø©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Ø§Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø®Ø· ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© */
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0d1117; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø¬Ø¯Ø§Ù‹ (Dark Mode) */
            color: #ffffff;
            direction: rtl;
        }
        
        /* Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© */
        :root {
            --bg-card: #161b22; /* Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
            --border: #30363d;
            --primary-color: #3b82f6; /* blue-500 */
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: Ø¹Ù…Ù‚ ÙˆØ§Ø±ØªÙØ§Ø¹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            will-change: transform, box-shadow;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Ø¥Ø¶Ø§ÙØ© Ø¸Ù„ Ø®ÙÙŠÙ */
        }
        .card:hover {
            transform: translateY(-4px); /* Ø§Ø±ØªÙØ§Ø¹ Ø£Ù‚Ù„ ÙˆØ£ÙƒØ«Ø± Ø³Ù„Ø§Ø³Ø© */
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15); /* Ø¸Ù„ Ø¨Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø®ÙÙŠÙ */
        }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±ÙŠØ§Ø­ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .wind-icon {
            animation: wind-spin 5s linear infinite;
            transform-origin: center center;
        }
        @keyframes wind-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .governorate-btn { text-align: right; justify-content: flex-end; }

        /* Ø³ØªØ§ÙŠÙ„Ø§Øª ØµÙØ­Ø© Ø§Ù„Ø­Ù„ÙˆÙ„ */
        .solution-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .solution-card:hover {
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-history {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #30363d;
            border-radius: 0.5rem;
            padding: 10px;
            background-color: #0d1117;
        }
        .user-message {
            background-color: #3b82f6;
            color: white;
            padding: 5px 10px;
            border-radius: 10px 10px 0 10px;
            align-self: flex-end;
            max-width: 80%;
        }
        .ai-message {
            background-color: #1e40af; /* Blue-700 */
            color: white;
            padding: 5px 10px;
            border-radius: 10px 10px 10px 0;
            align-self: flex-start;
            max-width: 90%;
            margin-top: 5px;
        }

        /* ØªÙˆØ­ÙŠØ¯ Ù…Ø¸Ù‡Ø± Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        #carbon-form input, #chat-form input {
            background-color: #2f333b; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙØªØ­ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            border: 1px solid #4b5563; /* Ø­Ø¯ÙˆØ¯ ÙˆØ§Ø¶Ø­Ø© */
            color: white;
            padding: 0.5rem;
            width: 100%;
            border-radius: 0.5rem; /* rounded-lg */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #carbon-form input:focus, #chat-form input:focus {
            border-color: #3b82f6; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        /* Ø³ØªØ§ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠÙ†Ø§Ø³Ø¨ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #carbon-form button, #chat-form button {
            background-color: #3b82f6; /* bg-blue-500 */
            /* width: 100%; // ØªÙ… Ø¥Ø²Ø§Ù„ØªÙ‡ Ù„Ø²Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
            margin-top: 10px;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 700;
            transition: background-color 0.3s;
        }
        #carbon-form button:hover, #chat-form button:hover {
            background-color: #2563eb; /* bg-blue-600 */
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµØºÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù‚Ø³ */
        .weather-detail-box {
            background-color: #1f2937; /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§ Ù…Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
            padding: 0.75rem;
            border-radius: 0.5rem;
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            border: 1px solid #374151;
            transition: background-color 0.2s;
        }
    </style>
</head>

<body>
    <div id="app-container">
    </div>

    <script>
        // *****************************************************************
        // 1. Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù€ API (Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ)
        // *****************************************************************
        const OWM_API_KEY = 'cbb0b418fa24260a8df56c9a7cd14c4e'; // OpenWeatherMap
        const WAQI_TOKEN = 'd1adfbee8313c81608cca5a505b9ed5e38f59823';  // WAQI (aqi.info)
        // Ù…ÙØªØ§Ø­ API Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
        const AI_GENERATIVE_API_KEY = 'AIzaSyAEEqwxJron2nbIyS51tDljtV7VBp9LlkI'; 
        
        // *****************************************************************
        // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (State Management)
        // *****************************************************************
        let currentView = 'dashboard'; // 'dashboard' Ø£Ùˆ 'solutions'
        let selectedCountry = 'Ù…ØµØ±';
        let selectedCity = 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©';
        let weatherData = null;
        let airQualityData = null;
        let healthRiskData = null;
        let treeCoverageData = null; 
        let disasterWarningData = null;
        let loading = true;
        let chatbotResponse = null; 
        let currentCoords = { lat: 30.0444, lon: 31.2357 };
        
        // *** Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ***
        let chatHistory = []; 

        // *** Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© ***
        let treesPlanted = 0; 
        const CO2_PER_TREE_KG = 22; // ÙƒØ¬Ù… CO2 ØªÙ…ØªØµÙ‡ Ø§Ù„Ø´Ø¬Ø±Ø© Ø³Ù†ÙˆÙŠØ§Ù‹ (Ù…ØªÙˆØ³Ø· ØªÙ‚Ø±ÙŠØ¨ÙŠ)
        const O2_PER_TREE_KG = 100; // ÙƒØ¬Ù… O2 ØªÙ†ØªØ¬Ù‡ Ø§Ù„Ø´Ø¬Ø±Ø© Ø³Ù†ÙˆÙŠØ§Ù‹ (Ù…ØªÙˆØ³Ø· ØªÙ‚Ø±ÙŠØ¨ÙŠ)

        const colors = {
            background: 'bg-gray-900', card: 'bg-gray-800', border: 'border-gray-700',
            primary: 'text-blue-400', primaryBg: 'bg-blue-400', primaryForeground: 'text-gray-900',
            foreground: 'text-white', mutedForeground: 'text-gray-400', mutedBg: 'bg-gray-700/30',
            secondaryAccent: 'text-amber-400',
        };

        // *****************************************************************
        // 3. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ ÙˆØ§Ù„Ù…Ø¯Ù† (Ù…ÙˆØ³Ø¹Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
        // *****************************************************************
        const globalLocations = {
            "Ù…ØµØ±": {
                "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©": { lat: 30.0444, lon: 31.2357, treeCoverage: 12, type: 'urban_nile', resources: ['ÙƒØ«Ø§ÙØ© Ø³ÙƒØ§Ù†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©', 'Ù…Ù†Ø§Ø·Ù‚ ØµÙ†Ø§Ø¹ÙŠØ©', 'Ø®Ø¯Ù…Ø§Øª Ø­ÙƒÙˆÙ…ÙŠØ©'], industries: ['ØµÙ†Ø§Ø¹Ø© Ø§Ù„ØºØ²Ù„ ÙˆØ§Ù„Ù†Ø³ÙŠØ¬', 'ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', 'ØªÙƒØ±ÙŠØ± Ø§Ù„Ø¨ØªØ±ÙˆÙ„'], pollution: 'Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØµÙ†Ø§Ø¹ÙŠØ©ØŒ Ù‚Ù…Ø§Ù…Ø©' },
                "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©": { lat: 31.2001, lon: 29.9187, treeCoverage: 18, type: 'coastal_med', resources: ['Ù…ÙŠÙ†Ø§Ø¡ (ØªØ¬Ø§Ø±Ø©)', 'Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…ØªÙˆØ³Ø·', 'ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ù†Ø³ÙŠØ¬'], industries: ['Ø§Ù„Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª', 'Ø§Ù„Ù†Ø³ÙŠØ¬ ÙˆØ§Ù„Ù…Ù„Ø§Ø¨Ø³', 'ØªØ¬Ø§Ø±Ø© Ø¨Ø­Ø±ÙŠØ©'], pollution: 'ØªÙ„ÙˆØ« Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨Ø­Ø±ØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª Ø§Ù„Ù…ØµØ§Ù†Ø¹ØŒ Ø¶ÙˆØ¶Ø§Ø¡ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡' },
                "Ø£Ø³ÙˆØ§Ù†": { lat: 24.0889, lon: 32.8998, treeCoverage: 4, type: 'upper_egypt_nile', resources: ['Ø³Ø·ÙˆØ¹ Ø´Ù…Ø³ÙŠ Ø¹Ø§Ù„Ù', 'Ù†ÙŠÙ„', 'Ù…Ø­Ø§Ø¬Ø± Ø¬Ø±Ø§Ù†ÙŠØª'], industries: ['ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ (Ø§Ù„Ø³Ø¯)', 'ØªØ¹Ø¯ÙŠÙ†', 'Ø³ÙŠØ§Ø­Ø© Ø£Ø«Ø±ÙŠØ©'], pollution: 'ØºØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø§Ø¬Ø±ØŒ Ù…Ø®Ù„ÙØ§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡' },
            },
            "Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©": {
                "Ø§Ù„Ø±ÙŠØ§Ø¶": { lat: 24.7136, lon: 46.6753, treeCoverage: 5, type: 'desert_urban', resources: ['Ù†ÙØ·', 'Ø®Ø¯Ù…Ø§Øª', 'Ø³Ø·ÙˆØ¹ Ø´Ù…Ø³ÙŠ Ø¹Ø§Ù„Ù'], industries: ['Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'Ø§Ù„Ø¨Ù†Ø§Ø¡', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª'], pollution: 'Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ ØºØ¨Ø§Ø±ØŒ ØªÙƒÙŠÙŠÙ' },
                "Ø¬Ø¯Ø©": { lat: 21.4858, lon: 39.1925, treeCoverage: 15, type: 'coastal_red_sea', resources: ['Ù…ÙŠÙ†Ø§Ø¡', 'Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±', 'ØªØ¬Ø§Ø±Ø©'], industries: ['ØªØ¬Ø§Ø±Ø© Ø¨Ø­Ø±ÙŠØ©', 'Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª', 'Ø³ÙŠØ§Ø­Ø©'], pollution: 'ØªÙ„ÙˆØ« Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡ØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØµÙ†Ø§Ø¹ÙŠØ©ØŒ Ø­Ø±Ø§Ø±Ø©' },
            },
            "Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©": {
                "Ø¯Ø¨ÙŠ": { lat: 25.2048, lon: 55.2708, treeCoverage: 20, type: 'coastal_urban', resources: ['Ø³ÙŠØ§Ø­Ø© ÙØ§Ø®Ø±Ø©', 'Ù…ÙˆØ§Ù†Ø¦ Ø¹Ø§Ù„Ù…ÙŠØ©', 'Ø·Ø§Ù‚Ø© Ø´Ù…Ø³ÙŠØ©'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'Ø®Ø¯Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©', 'Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª'], pollution: 'Ø¶ÙˆØ¶Ø§Ø¡ØŒ Ø·Ø§Ø¦Ø±Ø§ØªØŒ Ø¨Ù†Ø§Ø¡' },
                "Ø£Ø¨Ùˆ Ø¸Ø¨ÙŠ": { lat: 24.4539, lon: 54.3773, treeCoverage: 10, type: 'coastal_desert', resources: ['Ù†ÙØ·', 'Ù†Ø®ÙŠÙ„', 'Ø¨Ø­Ø±'], industries: ['Ù†ÙØ· ÙˆØºØ§Ø²', 'ØµÙ†Ø§Ø¹Ø§Øª Ø«Ù‚ÙŠÙ„Ø©', 'Ø·Ø§Ù‚Ø©'], pollution: 'Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØµÙ†Ø§Ø¹ÙŠØ©ØŒ ØªÙ„ÙˆØ« Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨Ø­Ø±' },
            },
            "Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©": {
                "Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ": { lat: 40.7128, lon: -74.0060, treeCoverage: 27, type: 'urban_coastal', resources: ['Ù…Ø§Ù„ÙŠØ©', 'Ù…ÙˆØ§Ù†Ø¦', 'Ø®Ø¯Ù…Ø§Øª'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'Ø¥Ø¹Ù„Ø§Ù…', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§'], pollution: 'Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ ØµÙ†Ø§Ø¹Ø©ØŒ Ù‚Ù…Ø§Ù…Ø©' },
                "Ù„ÙˆØ³ Ø£Ù†Ø¬Ù„ÙˆØ³": { lat: 34.0522, lon: -118.2437, treeCoverage: 18, type: 'urban_coastal', resources: ['ØªØ±ÙÙŠÙ‡', 'Ù…ÙŠÙ†Ø§Ø¡', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§'], industries: ['ØªØ±ÙÙŠÙ‡', 'ØªØ¬Ø§Ø±Ø© Ø¯ÙˆÙ„ÙŠØ©', 'Ø·ÙŠØ±Ø§Ù†'], pollution: 'Ø¶Ø¨Ø§Ø¨ Ø¯Ø®Ø§Ù†ÙŠØŒ Ø¹ÙˆØ§Ø¯Ù…ØŒ Ù…ÙŠØ§Ù‡ ØµØ±Ù' },
            },
            "ÙƒÙ†Ø¯Ø§": {
                "ØªÙˆØ±Ù†ØªÙˆ": { lat: 43.6532, lon: -79.3832, treeCoverage: 30, type: 'urban_lake', resources: ['Ø¨Ø­ÙŠØ±Ø§Øª', 'ØºØ§Ø¨Ø§Øª', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', 'Ø¥Ø¹Ù„Ø§Ù…'], pollution: 'ØªÙ„ÙˆØ« Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨Ø­ÙŠØ±Ø§ØªØŒ Ø¶ÙˆØ¶Ø§Ø¡ØŒ Ø¹ÙˆØ§Ø¯Ù…' },
            },
            "Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©": {
                "Ù„Ù†Ø¯Ù†": { lat: 51.5074, lon: 0.1278, treeCoverage: 22, type: 'urban_river', resources: ['Ù†Ù‡Ø± Ø§Ù„ØªØ§ÙŠÙ…Ø²', 'Ø®Ø¯Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©', 'ØªØ§Ø±ÙŠØ®'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'Ø®Ø¯Ù…Ø§Øª', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§'], pollution: 'Ø¹ÙˆØ§Ø¯Ù…ØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØªØ¯ÙØ¦Ø©ØŒ Ù†ÙØ§ÙŠØ§Øª' },
            },
            "ÙØ±Ù†Ø³Ø§": {
                "Ø¨Ø§Ø±ÙŠØ³": { lat: 48.8566, lon: 2.3522, treeCoverage: 25, type: 'urban_river', resources: ['Ù†Ù‡Ø± Ø§Ù„Ø³ÙŠÙ†', 'Ø³ÙŠØ§Ø­Ø©', 'Ø®Ø¯Ù…Ø§Øª'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'Ø£Ø²ÙŠØ§Ø¡', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§'], pollution: 'ØªÙ„ÙˆØ« Ù†Ù‡Ø± Ø§Ù„Ø³ÙŠÙ†ØŒ Ø¶ÙˆØ¶Ø§Ø¡ØŒ Ø¹ÙˆØ§Ø¯Ù…' },
            },
            "Ø£Ù„Ù…Ø§Ù†ÙŠØ§": {
                "Ø¨Ø±Ù„ÙŠÙ†": { lat: 52.5200, lon: 13.4050, treeCoverage: 28, type: 'urban_river', resources: ['Ø£Ù†Ù‡Ø§Ø±', 'ØºØ§Ø¨Ø§Øª', 'ØµÙ†Ø§Ø¹Ø§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©'], industries: ['ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', 'ØªØµÙ†ÙŠØ¹', 'Ø®Ø¯Ù…Ø§Øª'], pollution: 'ØªÙ„ÙˆØ« Ù…ØµØ§Ù†Ø¹ØŒ Ù†ÙØ§ÙŠØ§ØªØŒ Ø¹ÙˆØ§Ø¯Ù…' },
            },
            "Ø¥ÙŠØ·Ø§Ù„ÙŠØ§": {
                "Ø±ÙˆÙ…Ø§": { lat: 41.9028, lon: 12.4964, treeCoverage: 15, type: 'urban', resources: ['Ù…ÙˆØ§Ù‚Ø¹ Ø£Ø«Ø±ÙŠØ©', 'Ù…Ù†Ø§Ø® Ù…ØªÙˆØ³Ø·ÙŠ'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù…Ø©', 'ØªØ¬Ø§Ø±Ø©'], pollution: 'Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ ØªÙ„ÙˆØ« Ø£Ø«Ø±ÙŠØŒ Ù†ÙØ§ÙŠØ§Øª' },
            },
            "Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§": {
                "Ù…Ø¯Ø±ÙŠØ¯": { lat: 40.4168, lon: -3.7038, treeCoverage: 20, type: 'urban_highland', resources: ['Ù‡Ø¶Ø§Ø¨', 'Ø®Ø¯Ù…Ø§Øª'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'Ø§ØªØµØ§Ù„Ø§Øª', 'Ø³ÙŠØ§Ø­Ø©'], pollution: 'Ø¹ÙˆØ§Ø¯Ù…ØŒ Ø¬ÙØ§ÙØŒ Ø­Ø±Ø§Ø±Ø©' },
            },
            "Ø§Ù„ÙŠØ§Ø¨Ø§Ù†": {
                "Ø·ÙˆÙƒÙŠÙˆ": { lat: 35.6895, lon: 139.6917, treeCoverage: 20, type: 'urban_coastal', resources: ['Ø¨Ø­Ø±', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø¹Ø§Ù„ÙŠØ©', 'ÙƒØ«Ø§ÙØ© Ø³ÙƒØ§Ù†ÙŠØ©'], industries: ['ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', 'ØªØµÙ†ÙŠØ¹', 'Ù…Ø§Ù„ÙŠØ©'], pollution: 'ØªÙ„ÙˆØ« Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨Ø­Ø±ØŒ Ø¶ÙˆØ¶Ø§Ø¡ØŒ ÙƒØ«Ø§ÙØ©' },
            },
            "Ø§Ù„ØµÙŠÙ†": {
                "Ø¨ÙƒÙŠÙ†": { lat: 39.9042, lon: 116.4074, treeCoverage: 10, type: 'urban_basin', resources: ['ØµÙ†Ø§Ø¹Ø©', 'ÙƒØ«Ø§ÙØ© Ø³ÙƒØ§Ù†ÙŠØ©', 'Ø®Ø¯Ù…Ø§Øª Ø­ÙƒÙˆÙ…ÙŠØ©'], industries: ['ØµÙ†Ø§Ø¹Ø© Ø«Ù‚ÙŠÙ„Ø©', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', 'Ø¨Ù†Ø§Ø¡'], pollution: 'Ø¶Ø¨Ø§Ø¨ Ø¯Ø®Ø§Ù†ÙŠØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ÙØ­Ù…ØŒ ØªÙ„ÙˆØ« Ù‡ÙˆØ§Ø¡' },
            },
            "Ø§Ù„Ù‡Ù†Ø¯": {
                "Ù†ÙŠÙˆØ¯Ù„Ù‡ÙŠ": { lat: 28.6139, lon: 77.2090, treeCoverage: 15, type: 'urban_river', resources: ['Ù†Ù‡Ø± ÙŠØ§Ù…ÙˆÙ†Ø§', 'ÙƒØ«Ø§ÙØ© Ø³ÙƒØ§Ù†ÙŠØ© Ù‡Ø§Ø¦Ù„Ø©'], industries: ['Ø®Ø¯Ù…Ø§Øª Ø­ÙƒÙˆÙ…ÙŠØ©', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'ØªØµÙ†ÙŠØ¹'], pollution: 'Ø¬ÙˆØ¯Ø© Ù‡ÙˆØ§Ø¡ Ø³ÙŠØ¦Ø©ØŒ ØªÙ„ÙˆØ« Ù…ÙŠØ§Ù‡ØŒ Ø¶ÙˆØ¶Ø§Ø¡' },
            },
            "Ø±ÙˆØ³ÙŠØ§": {
                "Ù…ÙˆØ³ÙƒÙˆ": { lat: 55.7558, lon: 37.6173, treeCoverage: 30, type: 'urban_forest', resources: ['ØºØ§Ø¨Ø§Øª', 'Ø£Ù†Ù‡Ø±', 'ØµÙ†Ø§Ø¹Ø§Øª Ø«Ù‚ÙŠÙ„Ø©'], industries: ['ØµÙ†Ø§Ø¹Ø©', 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', 'Ù†ÙØ· ÙˆØºØ§Ø²'], pollution: 'Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØªØ¯ÙØ¦Ø©ØŒ Ù†ÙØ§ÙŠØ§Øª ØµÙ†Ø§Ø¹ÙŠØ©' },
            },
            "Ø¬Ù†ÙˆØ¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§": {
                "ÙƒÙŠØ¨ ØªØ§ÙˆÙ†": { lat: -33.9249, lon: 18.4241, treeCoverage: 22, type: 'coastal', resources: ['Ø¨Ø­Ø±', 'Ø¬Ø¨Ø§Ù„', 'Ø³ÙŠØ§Ø­Ø©'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'ØµÙ†Ø§Ø¹Ø§Øª ØºØ°Ø§Ø¦ÙŠØ©', 'Ø¨Ù†Ø§Ø¡'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ù†ÙØ§ÙŠØ§Øª Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠØ©ØŒ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠØ§Ù‡' },
            },
            "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„": {
                "Ø±ÙŠÙˆ Ø¯ÙŠ Ø¬Ø§Ù†ÙŠØ±Ùˆ": { lat: -22.9068, lon: -43.1729, treeCoverage: 25, type: 'coastal_tropical', resources: ['ØºØ§Ø¨Ø§Øª Ù…Ø·ÙŠØ±Ø©', 'Ø´ÙˆØ§Ø·Ø¦', 'Ù†ÙØ· ÙˆØºØ§Ø²'], industries: ['Ù†ÙØ· ÙˆØºØ§Ø²', 'Ø³ÙŠØ§Ø­Ø©', 'ØªØµÙ†ÙŠØ¹'], pollution: 'ØªÙ„ÙˆØ« Ø®Ù„ÙŠØ¬ØŒ ØªØµØ±ÙŠÙ ØºÙŠØ± ØµØ­ÙŠØŒ ÙØ§Ù‚Ø¯ Ø§Ù„ØºØ§Ø¨Ø§Øª' },
            },
            "Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§": {
                "Ø³ÙŠØ¯Ù†ÙŠ": { lat: -33.8688, lon: 151.2093, treeCoverage: 40, type: 'coastal_urban', resources: ['Ø´ÙˆØ§Ø·Ø¦', 'ØºØ§Ø¨Ø§Øª', 'Ù…Ø¹Ø§Ø¯Ù†'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'Ø¥Ø³ÙƒØ§Ù†', 'ØªØ¹Ø¯ÙŠÙ†'], pollution: 'Ø­Ø±Ø§Ø¦Ù‚ ØºØ§Ø¨Ø§ØªØŒ ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ø¶ÙˆØ¶Ø§Ø¡' },
            },
            "ØªØ±ÙƒÙŠØ§": {
                "Ø§Ø³Ø·Ù†Ø¨ÙˆÙ„": { lat: 41.0082, lon: 28.9784, treeCoverage: 15, type: 'urban_coastal', resources: ['Ù…Ø¶ÙŠÙ‚ Ø§Ù„Ø¨ÙˆØ³ÙÙˆØ±', 'ØªØ¬Ø§Ø±Ø©', 'Ø³ÙŠØ§Ø­Ø©'], industries: ['ØªØµÙ†ÙŠØ¹', 'ØªØ¬Ø§Ø±Ø© Ø¯ÙˆÙ„ÙŠØ©', 'Ø³ÙŠØ§Ø­Ø©'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ ÙƒØ«Ø§ÙØ© Ø³ÙƒØ§Ù†ÙŠØ©' },
            },
            "Ø§Ù„Ø£Ø±Ø¯Ù†": {
                "Ø¹Ù…Ù‘Ø§Ù†": { lat: 31.9539, lon: 35.9106, treeCoverage: 8, type: 'urban_desert', resources: ['Ø¬Ø¨Ø§Ù„', 'Ù…ÙˆØ§Ù‚Ø¹ Ø£Ø«Ø±ÙŠØ©', 'Ø´Ù…Ø³ Ø³Ø§Ø·Ø¹Ø©'], industries: ['Ø®Ø¯Ù…Ø§Øª', 'Ø¨Ù†Ø§Ø¡', 'Ù…Ø§Ù„ÙŠØ©'], pollution: 'ØºØ¨Ø§Ø±ØŒ Ø¹ÙˆØ§Ø¯Ù…ØŒ Ø¶ØºØ· Ù…Ø§Ø¦ÙŠ' },
            },
            "Ø§Ù„ÙƒÙˆÙŠØª": {
                "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆÙŠØª": { lat: 29.3759, lon: 47.9783, treeCoverage: 2, type: 'coastal_desert', resources: ['Ù†ÙØ·', 'Ø¨Ø­Ø±', 'Ø³Ø·ÙˆØ¹ Ø´Ù…Ø³ÙŠ Ø¹Ø§Ù„Ù'], industries: ['Ù†ÙØ· ÙˆØºØ§Ø²', 'ØµÙ†Ø§Ø¹Ø©', 'ØªØ¬Ø§Ø±Ø©'], pollution: 'Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª Ù†ÙØ·ÙŠØ©ØŒ Ø­Ø±Ø§Ø±Ø© Ø´Ø¯ÙŠØ¯Ø©ØŒ ØºØ¨Ø§Ø±' },
            },
            "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": {
                "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©": { lat: 36.7372, lon: 3.0865, treeCoverage: 10, type: 'urban_coastal', resources: ['Ø¨Ø­Ø± Ù…ØªÙˆØ³Ø·', 'Ù†ÙØ· ÙˆØºØ§Ø²'], industries: ['ØµÙ†Ø§Ø¹Ø©', 'Ù†ÙØ· ÙˆØºØ§Ø²', 'Ø®Ø¯Ù…Ø§Øª'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ø¹ÙˆØ§Ø¯Ù… Ù…Ø±ÙƒØ¨Ø§ØªØŒ ØªØµØ±ÙŠÙ ØµÙ†Ø§Ø¹ÙŠ' },
            },
            "Ø§Ù„Ù…ØºØ±Ø¨": {
                "Ø§Ù„Ø±Ø¨Ø§Ø·": { lat: 34.0209, lon: -6.8416, treeCoverage: 18, type: 'urban_coastal', resources: ['Ø¨Ø­Ø± Ø£Ø·Ù„Ø³ÙŠ', 'Ø²Ø±Ø§Ø¹Ø©', 'Ø³ÙŠØ§Ø­Ø©'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'Ø²Ø±Ø§Ø¹Ø©', 'Ù…Ù†Ø³ÙˆØ¬Ø§Øª'], pollution: 'ØªÙ„ÙˆØ« Ù…Ø§Ø¦ÙŠØŒ Ù†ÙØ§ÙŠØ§Øª ØµÙ„Ø¨Ø©ØŒ Ø¹ÙˆØ§Ø¯Ù…' },
            },
            "ØªÙˆÙ†Ø³": {
                "ØªÙˆÙ†Ø³ Ø§Ù„Ø¹Ø§ØµÙ…Ø©": { lat: 36.8065, lon: 10.1815, treeCoverage: 15, type: 'urban_coastal', resources: ['Ø¨Ø­Ø± Ù…ØªÙˆØ³Ø·', 'Ø²ÙŠØªÙˆÙ†', 'Ø³ÙŠØ§Ø­Ø©'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'ØªØµÙ†ÙŠØ¹', 'Ø®Ø¯Ù…Ø§Øª'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ù†ÙØ§ÙŠØ§Øª ØµÙ†Ø§Ø¹ÙŠØ©ØŒ Ø¹ÙˆØ§Ø¯Ù…' },
            },
            "Ø§Ù„Ø¹Ø±Ø§Ù‚": {
                "Ø¨ØºØ¯Ø§Ø¯": { lat: 33.3152, lon: 44.3661, treeCoverage: 5, type: 'urban_river', resources: ['Ù†Ù‡Ø± Ø¯Ø¬Ù„Ø©', 'Ù†ÙØ·'], industries: ['Ù†ÙØ·', 'ØªØµÙ†ÙŠØ¹', 'Ø¨Ù†Ø§Ø¡'], pollution: 'ØªÙ„ÙˆØ« Ù‡ÙˆØ§Ø¡ØŒ ØºØ¨Ø§Ø±ØŒ ØªÙ„ÙˆØ« Ù…ÙŠØ§Ù‡ Ø¯Ø¬Ù„Ø©' },
            },
            "Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†": {
                "Ø§Ù„Ù…Ù†Ø§Ù…Ø©": { lat: 26.2285, lon: 50.586, treeCoverage: 8, type: 'coastal_island', resources: ['Ø¨Ø­Ø±', 'Ù†ÙØ·', 'Ø®Ø¯Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'Ù†ÙØ·', 'ØªØ¬Ø§Ø±Ø©'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØµÙ†Ø§Ø¹ÙŠØ©ØŒ Ø­Ø±Ø§Ø±Ø©' },
            },
            "Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†": {
                "Ù…Ø³Ù‚Ø·": { lat: 23.5859, lon: 58.6009, treeCoverage: 10, type: 'coastal_mountain', resources: ['Ø¨Ø­Ø± Ø¹Ù…Ø§Ù†', 'Ø¬Ø¨Ø§Ù„', 'Ù†ÙØ·'], industries: ['Ù†ÙØ·', 'Ø³ÙŠØ§Ø­Ø©', 'Ø®Ø¯Ù…Ø§Øª'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ ØªØ¢ÙƒÙ„ Ø§Ù„ØªØ±Ø¨Ø©ØŒ Ø­Ø±Ø§Ø±Ø©' },
            },
            "Ù‚Ø·Ø±": {
                "Ø§Ù„Ø¯ÙˆØ­Ø©": { lat: 25.2854, lon: 51.5310, treeCoverage: 12, type: 'coastal_desert', resources: ['ØºØ§Ø² Ø·Ø¨ÙŠØ¹ÙŠ', 'Ø¨Ø­Ø±', 'Ø³Ø·ÙˆØ¹ Ø´Ù…Ø³ÙŠ'], industries: ['ØºØ§Ø² Ø·Ø¨ÙŠØ¹ÙŠ', 'Ù…Ø§Ù„ÙŠØ©', 'Ø¹Ù‚Ø§Ø±Ø§Øª'], pollution: 'Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª ØµÙ†Ø§Ø¹ÙŠØ©ØŒ Ø¶ÙˆØ¶Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø§Ø¡ØŒ Ø­Ø±Ø§Ø±Ø©' },
            },
            "Ø³ÙˆØ±ÙŠØ§": {
                "Ø¯Ù…Ø´Ù‚": { lat: 33.5132, lon: 36.2913, treeCoverage: 10, type: 'urban_river', resources: ['Ù†Ù‡Ø± Ø¨Ø±Ø¯Ù‰', 'ØªØ§Ø±ÙŠØ®'], industries: ['Ø²Ø±Ø§Ø¹Ø©', 'ØµÙ†Ø§Ø¹Ø§Øª Ø®ÙÙŠÙØ©', 'ØªØ¬Ø§Ø±Ø©'], pollution: 'ØªÙ„ÙˆØ« Ù†Ù‡Ø±ØŒ Ø¹ÙˆØ§Ø¯Ù…ØŒ Ù†ÙØ§ÙŠØ§Øª ØµÙ„Ø¨Ø©' },
            },
            "Ù„Ø¨Ù†Ø§Ù†": {
                "Ø¨ÙŠØ±ÙˆØª": { lat: 33.8938, lon: 35.5018, treeCoverage: 15, type: 'urban_coastal', resources: ['Ø¨Ø­Ø± Ù…ØªÙˆØ³Ø·', 'Ø¬Ø¨Ø§Ù„'], industries: ['Ù…Ø§Ù„ÙŠØ©', 'Ø³ÙŠØ§Ø­Ø©', 'ØªØ¬Ø§Ø±Ø©'], pollution: 'ØªÙ„ÙˆØ« Ø¨Ø­Ø±ÙŠØŒ Ø£Ø²Ù…Ø© Ù†ÙØ§ÙŠØ§ØªØŒ Ø¶ÙˆØ¶Ø§Ø¡' },
            },
            "ÙÙ„Ø³Ø·ÙŠÙ†": {
                "Ø§Ù„Ù‚Ø¯Ø³": { lat: 31.7683, lon: 35.2137, treeCoverage: 18, type: 'urban_highland', resources: ['Ø¬Ø¨Ø§Ù„', 'Ù…ÙˆØ§Ù‚Ø¹ Ø¯ÙŠÙ†ÙŠØ©'], industries: ['Ø³ÙŠØ§Ø­Ø©', 'Ø®Ø¯Ù…Ø§Øª', 'Ø¨Ù†Ø§Ø¡'], pollution: 'Ø¹ÙˆØ§Ø¯Ù…ØŒ Ù†ÙØ§ÙŠØ§ØªØŒ Ø¶ØºØ· Ù…Ø§Ø¦ÙŠ' },
            },
        };

        // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©
        const getGeocodingAndResources = (country, city) => {
            const countryData = globalLocations[country];
            if (countryData && countryData[city]) {
                return {
                    lat: countryData[city].lat,
                    lon: countryData[city].lon,
                    treeCoverage: countryData[city].treeCoverage,
                    resources: countryData[city].resources,
                    industries: countryData[city].industries,
                    pollution: countryData[city].pollution,
                    type: countryData[city].type
                };
            }
            // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
            return {
                lat: 0, lon: 0, treeCoverage: 5, type: 'generic', resources: ['Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©'], industries: ['Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©'], pollution: 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©'
            };
        };
        
        // Ø¬Ù„Ø¨ Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© (Ù…Ø­Ø¯Ø«Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… getGeocodingAndResources)
        const getGovernorateResources = (country, city) => {
            const data = getGeocodingAndResources(country, city);
            return {
                resources: data.resources,
                industries: data.industries,
                pollution: data.pollution,
                type: data.type
            };
        };

        // *****************************************************************
        // 4. Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª (IconMap)
        // *****************************************************************
        const IconMap = {
            Tree: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10a6 6 0 0 0-12 0c0 5 6 9 6 9s6-4 6-9zM12 19v3"/></svg>`,
            Location: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
            Wind: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.7 15.3A2.5 2.5 0 1 0 10 12h8m-8-3h8m-8-3h8"/><path d="M16 4h4v4"/><path d="M4 20h4v-4"/></svg>`,
            Droplet: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66c4.66 4.66 4.66 12.25 0 16.91-4.66 4.66-12.25 4.66-16.91 0-4.66-4.66-4.66-12.25 0-16.91L12 2.69z"/></svg>`,
            Sun: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/></svg>`,
            Satellite: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6zm0 18c-3.31 0-6-2.69-6-6h2c0 2.21 1.79 4 4 4s4-1.79 4-4h2c0 3.31-2.69 6-6 6z"/><path d="M16 8h4"/><path d="M4 8h4"/></svg>`,
            LocationLarge: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
            AirLarge: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66c4.66 4.66 4.66 12.25 0 16.91-4.66 4.66-12.25 4.66-16.91 0-4.66-4.66-4.66-12.25 0-16.91L12 2.69z"/><path d="M12 2a10 10 0 0 0-4 1.09"/><path d="M12 2a10 10 0 0 1 4 1.09"/><path d="M12 22a10 10 0 0 0 4-1.09"/><path d="M12 22a10 10 0 0 1-4-1.09"/><path d="M22 12h-2"/><path d="M4 12h2"/></svg>`,
            Alert: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
            AlertTriangle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg>`,
            Earthquake: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 16.5l2-3 2 3 2-3 2 3 2-3 2 3"/><path d="M3 10h18"/><path d="M3 14h18"/></svg>`,
            RainDrops: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v10l-4 4m8-4l-4 4"/><circle cx="12" cy="18" r="4"/></svg>`,
            Thermometer: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></svg>`,
            WindHigh: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.7 15.3A2.5 2.5 0 1 0 10 12h8m-8-3h8m-8-3h8"/><path d="M16 4h4v4"/><path d="M4 20h4v-4"/></svg>`,
            Economy: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/><path d="M18 10h-5"/><path d="M16 14h-5"/></svg>`,
            Factory: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19h-1.5a1.5 1.5 0 0 1 0-3H22v3zM22 16h-3.5a1.5 1.5 0 0 1 0-3H22v3zM22 13h-4.5a1.5 1.5 0 0 1 0-3H22v3zM2 22v-2a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v2H2zM4 19V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v13H4zM9 19V9m6 10V9m-3 0v10"/></svg>`,
            Co2: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 6h3a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1h-3M7 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3M14 12c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4z"/></svg>`,
            Oxygen: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v8m-4-4h8"/></svg>`,
            Cloud: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>`
        };

        // *****************************************************************
        // 5. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (Utility Functions)
        // *****************************************************************
        const formatTime = (unixTimestamp) => {
            if (!unixTimestamp) return 'N/A';
            const date = new Date(unixTimestamp * 1000);
            return new Intl.DateTimeFormat('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: false }).format(date);
        };
        const getAqiStatus = (aqi) => {
            if (aqi === null || aqi === undefined) return "ØºÙŠØ± Ù…ØªÙˆÙØ±";
            if (aqi <= 50) return "Ø¬ÙŠØ¯"; if (aqi <= 100) return "Ù…Ø¹ØªØ¯Ù„"; if (aqi <= 150) return "ØºÙŠØ± ØµØ­ÙŠ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©";
            if (aqi <= 200) return "ØºÙŠØ± ØµØ­ÙŠ"; return "Ø®Ø·Ø± Ø¬Ø¯Ø§Ù‹";
        };
        const getAqiColor = (aqi) => {
            if (aqi === null || aqi === undefined) return "text-gray-500";
            if (aqi <= 50) return "text-green-400"; if (aqi <= 100) return "text-yellow-400"; if (aqi <= 150) return "text-orange-400";
            if (aqi <= 200) return "text-red-500"; return "text-purple-600";
        };
        const getTreeStatus = (percentage) => {
            if (percentage >= 20) return { status: "Ù…Ù…ØªØ§Ø²", recommendation: "Ø§Ù„ÙˆØ¶Ø¹ Ù…Ù…ØªØ§Ø²ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡.", color: "text-green-400", barColor: "bg-green-500" };
            if (percentage >= 10) return { status: "Ø¬ÙŠØ¯ØŒ ØªØ­ØªØ§Ø¬ Ù„Ø²ÙŠØ§Ø¯Ø©", recommendation: "ÙˆØ¶Ø¹ Ø¬ÙŠØ¯ØŒ ÙŠÙÙ†ØµØ­ Ø¨Ø²ÙŠØ§Ø¯Ø© Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ù„ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡.", color: "text-yellow-400", barColor: "bg-yellow-500" };
            return { status: "Ø¶Ø¹ÙŠÙØŒ Ù…Ø·Ù„ÙˆØ¨ Ø²Ø±Ø§Ø¹Ø© ÙÙˆØ±ÙŠØ©", recommendation: "Ù†Ø³Ø¨Ø© Ù…Ù†Ø®ÙØ¶Ø©ØŒ ÙŠÙˆØµÙ‰ Ø¨Ø¨Ø¯Ø¡ Ø­Ù…Ù„Ø§Øª Ø²Ø±Ø§Ø¹Ø© ÙÙˆØ±ÙŠØ© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø´Ø¬Ø±ÙŠØ©.", color: "text-red-400", barColor: "bg-red-500" };
        };
        const calculateHealthRisk = (aqi, temp, humidity) => {
            if (aqi === null || temp === null) return 0;
            let aqiWeight = Math.min(aqi / 200, 1) * 50;
            let tempFactor = 0;
            if (temp >= 35) tempFactor = 40; else if (temp >= 30) tempFactor = 25; else if (temp >= 25) tempFactor = 10;
            let humidityFactor = Math.max(0, humidity - 60) * 0.5;
            let totalRisk = aqiWeight + tempFactor + humidityFactor;
            return Math.min(100, Math.round(totalRisk)); 
        };
        const getHealthRiskStatus = (percentage, aqi, temp) => {
            let status, recommendation, color, barColor, healthDetails;
            if (percentage > 80) { status = "Ø®Ø·Ø± Ø¬Ø³ÙŠÙ…"; recommendation = "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø·ÙˆØ§Ø±Ø¦ ÙÙˆØ±ÙŠØ©ØŒ ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª Ù„Ø£Ù‚ØµÙ‰ Ø·Ø§Ù‚Ø© Ø§Ø³ØªÙŠØ¹Ø§Ø¨ÙŠØ©."; color = "text-red-500"; barColor = "bg-red-500";
            } else if (percentage > 60) { status = "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹"; recommendation = "ØªÙØ¹ÙŠÙ„ Ø®Ø·Ø· Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø§Ù„Ù…Ø¨ÙƒØ± ÙˆØ²ÙŠØ§Ø¯Ø© ÙØ±Ù‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø­Ø±Ø¬Ø©."; color = "text-orange-500"; barColor = "bg-orange-500";
            } else if (percentage >= 50) { status = "Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ Ù…Ø±ØªÙØ¹"; recommendation = "ØªØ¬Ø§ÙˆØ² Ø­Ø¯ 50% ÙŠØªØ·Ù„Ø¨ Ø±ÙØ¹ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø·Ø¨ÙŠØ©."; color = "text-yellow-500"; barColor = "bg-yellow-500";
            } else if (percentage > 20) { status = "Ù…Ù†Ø®ÙØ¶"; recommendation = "Ø§Ù„ÙˆØ¶Ø¹ Ù…Ø³ØªÙ‚Ø±ØŒ Ù…Ø¹ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªÙ„ÙˆØ« ÙˆØ§Ù„Ø­Ø±Ø§Ø±Ø© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ."; color = "text-green-500"; barColor = "bg-green-500";
            } else { status = "Ø¢Ù…Ù† Ø¬Ø¯Ø§Ù‹"; recommendation = "Ø§Ù„ÙˆØ¶Ø¹ Ù…Ù…ØªØ§Ø². ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø±ÙˆØªÙŠÙ†ÙŠØ©."; color = "text-lime-500"; barColor = "bg-lime-500"; }
            healthDetails = {
                respiratory: { level: "Ù…Ù†Ø®ÙØ¶", advice: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©.", color: "text-green-400" },
                allergy: { level: "Ù…Ù†Ø®ÙØ¶Ø©", advice: "ÙŠÙ…ÙƒÙ† Ù„Ù…Ù† ÙŠØ¹Ø§Ù†ÙˆÙ† Ù…Ù† Ø­Ø³Ø§Ø³ÙŠØ© Ø´Ø¯ÙŠØ¯Ø© Ø§Ø±ØªØ¯Ø§Ø¡ Ù‚Ù†Ø§Ø¹ N95 Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ….", color: "text-green-400" },
                heatStress: { level: "Ù…Ù†Ø®ÙØ¶", advice: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©. ÙŠÙÙ†ØµØ­ Ø¨Ø´Ø±Ø¨ ÙƒÙ…ÙŠØ§Øª ÙƒØ§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡.", color: "text-lime-400" }
            };
            if (aqi > 100) { healthDetails.respiratory = { level: "Ù…ØªÙˆØ³Ø·", advice: "ÙŠÙ†Ø¨ØºÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø·ÙØ§Ù„ ÙˆÙƒØ¨Ø§Ø± Ø§Ù„Ø³Ù† ÙˆÙ…Ø±Ø¶Ù‰ Ø§Ù„Ø±Ø¨Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ø·Ù„Ù‚.", color: "text-yellow-400" }; healthDetails.allergy = { level: "Ù…ØªÙˆØ³Ø·Ø© Ø¥Ù„Ù‰ Ù…Ø±ØªÙØ¹Ø©", advice: "Ù…Ø³ØªÙˆÙŠØ§Øª Ù…Ø³Ø¨Ø¨Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ø±ØªÙØ¹Ø©. ÙŠÙØ¶Ù„ ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ.", color: "text-yellow-400" }; }
            if (aqi > 150) { healthDetails.respiratory = { level: "Ù…Ø±ØªÙØ¹", advice: "ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù…ÙŠØ¹ ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ù…Ø¬Ù‡Ø¯Ø©. Ø¹Ù„Ù‰ Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„.", color: "text-red-400" }; healthDetails.allergy = { level: "Ù…Ø±ØªÙØ¹Ø© Ø¬Ø¯Ø§Ù‹", advice: "Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°. Ø§Ø³ØªØ´Ø± Ø·Ø¨ÙŠØ¨Ùƒ Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø¶Ø§Ø¯Ø© Ù„Ù„Ø­Ø³Ø§Ø³ÙŠØ©.", color: "text-red-400" }; }
            if (temp >= 35) { healthDetails.heatStress = { level: "Ù…Ø±ØªÙØ¹", advice: "ØªØ­Ø°ÙŠØ±: Ø®Ø·Ø± Ø§Ù„Ø¥ØµØ§Ø¨Ø© Ø¨Ø¶Ø±Ø¨Ø© Ø§Ù„Ø´Ù…Ø³. ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙÙŠ Ø§Ù„Ø¸Ù‡ÙŠØ±Ø©ØŒ Ø§Ø±ØªØ¯Ø§Ø¡ Ù‚Ø¨Ø¹Ø© ÙØ§ØªØ­Ø© Ø§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„ØªØ±Ø·ÙŠØ¨ Ø§Ù„Ù…Ø³ØªÙ…Ø±.", color: "text-red-400" };
            } else if (temp >= 30) { healthDetails.heatStress = { level: "Ù…ØªÙˆØ³Ø·", advice: "ÙŠÙÙˆØµÙ‰ Ø¨Ø£Ø®Ø° ÙØªØ±Ø§Øª Ø±Ø§Ø­Ø© Ù…ØªÙƒØ±Ø±Ø© ÙˆØ´Ø±Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ Ø¨ÙƒØ«Ø±Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø­Ø±Ø§Ø±ÙŠ.", color: "text-orange-400" }; }
            return { status, recommendation, color, barColor, healthDetails };
        };
        const getDisasterWarning = (weatherData) => {
            const warnings = []; if (!weatherData) return warnings;
            const temp = weatherData?.main?.temp ?? 0, windSpeed = weatherData?.wind?.speed ?? 0, weatherDescription = weatherData?.weather?.[0]?.description ?? '', weatherMain = weatherData?.weather?.[0]?.main ?? '';
            if (temp >= 40) warnings.push({ type: "Ø®Ø·Ø± Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù‚ØµÙˆÙ‰", iconColor: "text-red-500", message: `ØªØ­Ø°ÙŠØ± Ù…Ù† Ù…ÙˆØ¬Ø© Ø­Ø± Ø´Ø¯ÙŠØ¯Ø©: Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© ${Math.round(temp)}Â°C. ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø´Ù…Ø³.`, priority: 4 });
            else if (temp >= 35) warnings.push({ type: "ØªØ­Ø°ÙŠØ± Ù…Ù† Ø¥Ø¬Ù‡Ø§Ø¯ Ø­Ø±Ø§Ø±ÙŠ", iconColor: "text-orange-400", message: `Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©: Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© ${Math.round(temp)}Â°C. Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø·ÙŠØ¨.`, priority: 3 });
            if (windSpeed >= 15) warnings.push({ type: "Ø®Ø·Ø± Ø§Ù„Ø¹ÙˆØ§ØµÙ Ø§Ù„Ø±Ù…Ù„ÙŠØ©/Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ©", iconColor: "text-red-500", message: `Ø³Ø±Ø¹Ø© Ø±ÙŠØ§Ø­ Ø¹Ø§Ù„ÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ ${windSpeed.toFixed(1)} Ù…/Ø«. Ø®Ø·Ø± Ø§Ù„Ø¹ÙˆØ§ØµÙ Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ©.`, priority: 5 });
            else if (windSpeed >= 10) warnings.push({ type: "ØªØ­Ø°ÙŠØ± Ù…Ù† Ø±ÙŠØ§Ø­ Ù‚ÙˆÙŠØ©", iconColor: "text-yellow-400", message: `Ø±ÙŠØ§Ø­ Ù‚ÙˆÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ ${windSpeed.toFixed(1)} Ù…/Ø«.`, priority: 3 });
            if (weatherMain.includes("Rain") || weatherMain.includes("Drizzle")) { let priority = 2, iconColor = "text-sky-400"; if (weatherDescription.includes("heavy") || weatherDescription.includes("ØºØ²ÙŠØ±")) { priority = 4; iconColor = "text-blue-500"; } warnings.push({ type: "ØªØ­Ø°ÙŠØ± Ù…Ù† Ø£Ù…Ø·Ø§Ø±", iconColor: iconColor, message: `ØªÙˆÙ‚Ø¹Ø§Øª Ø¨Ù€ ${weatherDescription}. ØªÙˆØ®Ù‰ Ø§Ù„Ø­Ø°Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±Ù‚.`, priority: priority }); }
            if (new Date().getMinutes() % 5 === 0) warnings.push({ type: "ØªÙ†Ø¨ÙŠÙ‡ Ø²Ù„Ø²Ø§Ù„ÙŠ Ø¥Ù‚Ù„ÙŠÙ…ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©)", iconColor: "text-purple-500", message: `Ø±ØµØ¯ Ù‡Ø²Ø© Ø£Ø±Ø¶ÙŠØ© Ø¨Ù‚ÙˆØ© 5.2 Ø±ÙŠØ®ØªØ± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø©.`, priority: 6 });
            return warnings.sort((a, b) => b.priority - a.priority);
        };
        const LoadingSpinner = (message = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...") => `
            <div class="flex flex-col justify-center items-center h-full min-h-[8rem] space-y-3">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-r-2 border-t-2 border-blue-400"></div>
                <p class="text-sm text-gray-400">${message}</p>
            </div>
        `;
        const CardTemplate = (title, iconSvg, colorClass, contentHtml, span = "col-span-1") => `
            <div class="card rounded-2xl p-6 shadow-xl ${span}">
                <div class="flex items-center gap-3 mb-4 border-b border-gray-700/50 pb-3">
                    <div class="w-6 h-6 ${colorClass} ${title === 'Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­' ? 'wind-icon' : ''}">${iconSvg}</div>
                    <span class="text-xl font-semibold text-white">${title}</span>
                </div>
                ${loading && title !== "ğŸ® Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ´Ø¬ÙŠØ±" && title !== "ğŸŒ± Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠØ©)" && title !== "ğŸ¤– Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø°ÙƒÙŠØ© (Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)" ? LoadingSpinner(`Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ${title}...`) : contentHtml}
            </div>
        `;

 // *****************************************************************
// *****************************************************************
// 5.5. Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ (Chatbot Logic)
// *****************************************************************
        const generateAiResponse = async (userPrompt, isChat = false) => {
            const GEMINI_API_KEY = "AIzaSyAEEqwxJron2nbIyS51tDljtV7VBp9LlkI"; 
            const MODEL_NAME = 'gemini-2.0-flash-exp';
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${GEMINI_API_KEY}`;

            const resources = getGovernorateResources(selectedCountry, selectedCity);
            const treeData = treeCoverageData;
            const aqi = airQualityData?.data?.aqi ?? 0;
            const temp = weatherData?.main?.temp ?? 0;
            
            let promptContent;
            if (isChat) {
                promptContent = `Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ù‚ Ù…Ø¯ÙŠÙ†Ø© ${selectedCity}ØŒ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ (AQI: ${aqi}) ÙˆØ§Ù„Ø­Ø±Ø§Ø±Ø© (${temp}Â°C): ${userPrompt}`;
            } else {
                promptContent = `
                    Ù‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø´Ø§Ù…Ù„ Ù„Ù…Ø¯ÙŠÙ†Ø© ${selectedCity} ÙÙŠ ${selectedCountry}.
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:
                    - Ù…Ø¤Ø´Ø± Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ (AQI): ${aqi}
                    - Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø´Ø¬Ø±ÙŠØ©: ${treeData.percentage}% (Ø§Ù„Ø­Ø§Ù„Ø©: ${treeData.status})
                    - Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„ØµÙ†Ø§Ø¹Ø§Øª: ${resources.resources.join(', ')}ØŒ ${resources.industries.join(', ')}
                    - Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: ${resources.pollution}

                    Ù‚Ø¯Ù… Ù…Ù„Ø®ØµØ§Ù‹ ØªØ­Ù„ÙŠÙ„ÙŠØ§Ù‹ ÙŠØ¨Ø¯Ø£ Ø¨Ø¬Ù…Ù„Ø© "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø®Ø¨ÙŠØ± Ø§Ù„Ø°ÙƒÙŠØŒ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù…Ù† Google Gemini!"ØŒ Ø«Ù… Ù‚Ø¯Ù… ØªÙˆØµÙŠØ§Øª Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©.
                `;
            }

            const payload = {
                contents: [{ 
                    role: "user", 
                    parts: [{ text: promptContent }] 
                }],
                generationConfig: {
                    temperature: isChat ? 0.7 : 0.3,
                    maxOutputTokens: isChat ? 512 : 1024
                }
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.error?.message || response.statusText;
                    throw new Error(`Gemini API Error (${response.status}): ${errorMessage}`);
                }

                const data = await response.json();
                const aiResponseText = data.candidates?.[0]?.content?.parts?.[0]?.text || "ØªØ¹Ø°Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø±Ø¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.";
                
                return aiResponseText.split('\n').filter(line => line.trim() !== '');

            } catch (error) {
                console.error("Gemini API call failed:", error);
                return [
                    "âš ï¸ ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ.",
                    `* Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„ÙÙ†ÙŠ: ${error.message}`
                ];
            }
        };


        // *****************************************************************
        // 5.6. Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ - Ø§Ù„Ø¨ÙŠØ¦ÙŠ (Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±)
        // *****************************************************************
        const getEconomicEnvironmentalAnalysis = () => {
            const { resources, industries, pollution } = getGovernorateResources(selectedCountry, selectedCity);
            const aqi = airQualityData?.data?.aqi ?? 0;
            const treePercentage = treeCoverageData?.percentage ?? 0;
            
            if (!resources) {
                return { status: "ØºÙŠØ± Ù…ØªÙˆÙØ±", analysis: ["Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© ÙˆØ§Ù„Ø¨ÙŠØ¦ÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©."] };
            }

            let analysis = [];
            let status = "ØªÙˆØ§Ø²Ù† Ù…Ù‚Ø¨ÙˆÙ„";
            let color = "text-blue-400";
            
            // 1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙ†Ø§Ø¹Ø§Øª ÙˆØ§Ù„ØªÙ„ÙˆØ«
            analysis.push({
                title: "Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ/Ø§Ù„Ø¨ÙŠØ¦ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", 
                details: `Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ù‚Ø·Ø§Ø¹ **${industries[0]}** ÙŠØ³Ø¨Ø¨ ØªØ­Ø¯ÙŠØ§Øª Ø¨ÙŠØ¦ÙŠØ© Ù…Ø«Ù„ **${pollution}**.`,
                icon: IconMap.Factory
            });

            // 2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆÙØ±Øµ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©
            analysis.push({
                title: "ÙØ±Øµ Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø£Ø®Ø¶Ø±", 
                details: `ØªÙˆÙØ± Ù…ÙˆØ§Ø±Ø¯ Ù…Ø«Ù„ **${resources[0]}** Ùˆ **${resources[1]}** ÙŠÙØªØ­ Ø§Ù„Ø¨Ø§Ø¨ Ø£Ù…Ø§Ù… Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØªØ¬Ø¯Ø¯Ø© Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©ØŒ Ù„Ø®ÙØ¶ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ù„ÙˆØ«Ø©.`,
                icon: IconMap.Sun
            });
            
            // 3. Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙˆØ§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø´Ø¬Ø±ÙŠØ©
            if (aqi > 100 || treePercentage < 10) {
                analysis.push({
                    title: "Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©", 
                    details: `Ø§Ù†Ø®ÙØ§Ø¶ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ (${aqi} AQI) ÙˆØ¶Ø¹Ù Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ø´Ø¬Ø±ÙŠ (${treePercentage}%) ÙŠÙÙ‡Ø¯Ø¯ Ø¨Ø²ÙŠØ§Ø¯Ø© ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ© ÙˆØ®Ø³Ø§Ø±Ø© Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©/Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©.`,
                    icon: IconMap.AlertTriangle
                });
                status = "ØªÙˆØ§Ø²Ù† Ù…ÙÙ‡Ø¯ÙÙ‘Ø¯";
                color = "text-orange-400";
            } else {
                analysis.push({
                    title: "Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© (Capital)", 
                    details: `Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸ÙŠÙØ© ÙˆØ±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙŠØ¯Ø¹Ù…Ø§Ù† Ù‚Ø·Ø§Ø¹Ø§Øª **Ø§Ù„Ø³ÙŠØ§Ø­Ø©** Ùˆ **Ø§Ù„Ø²Ø±Ø§Ø¹Ø©** ÙƒÙ…Ø­Ø±ÙƒØ§Øª Ù„Ù„Ù†Ù…Ùˆ Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù….`,
                    icon: IconMap.Economy
                });
            }

            return { status, analysis, color };
        };


        // *****************************************************************
        // 6. Ù…Ù†Ø·Ù‚ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Fetching Logic)
        // *****************************************************************
        
        // *****************************************************************
        // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø±Ø¯ Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª Ø§Ù„Ø£ÙˆÙ„ÙŠ
        // *****************************************************************
        const fetchChatbotResponse = async () => {
            try {
                const response = await generateAiResponse("", false);
                return response;
            } catch (error) {
                console.error("Failed to fetch chatbot response:", error);
                return ["âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹."];
            }
        };


        const fetchData = async () => {
            loading = true;
            chatbotResponse = null; 
            chatHistory = []; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ø¯ÙˆÙ„Ø©
            render(); 

            const geoData = getGeocodingAndResources(selectedCountry, selectedCity);
            currentCoords.lat = geoData.lat;
            currentCoords.lon = geoData.lon;
            
            const lat = currentCoords.lat;
            const lon = currentCoords.lon;
            const treeCoverage = geoData.treeCoverage;

            const OWM_URL = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OWM_API_KEY}&units=metric&lang=ar`;
            const AQI_URL = `https://api.waqi.info/feed/geo:${lat};${lon}/?token=${WAQI_TOKEN}`;
            
            treeCoverageData = { percentage: treeCoverage, ...getTreeStatus(treeCoverage) }; 

            try {
                const [weatherResponse, aqiResponse] = await Promise.all([ 
                    fetch(OWM_URL).then(res => res.json()), 
                    fetch(AQI_URL).then(res => res.json())
                ]);

                weatherData = weatherResponse.cod === 200 ? weatherResponse : null;
                airQualityData = aqiResponse.status === 'ok' ? aqiResponse : null;
                
                disasterWarningData = getDisasterWarning(weatherData);
                const currentAqi = airQualityData?.data?.aqi ?? 0, currentTemp = weatherData?.main?.temp ?? 0, currentHumidity = weatherData?.main?.humidity ?? 0;
                const riskPercentage = calculateHealthRisk(currentAqi, currentTemp, currentHumidity);
                healthRiskData = { percentage: riskPercentage, ...getHealthRiskStatus(riskPercentage, currentAqi, currentTemp) };
                
                chatbotResponse = await fetchChatbotResponse(); 
                
                // Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…Ù† Ø§Ù„Ø±ÙˆØ¨ÙˆØª Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                chatHistory.push({ role: 'ai', text: `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø®Ø¨ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ Ù„Ù€ ${selectedCity}. ØªÙØ¶Ù„ Ø¨Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ø­ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©ØŒ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ØŒ Ø£Ùˆ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ù‡Ù†Ø§.` });

            } catch (error) {
                console.error("Failed to fetch data:", error);
                weatherData = null; airQualityData = null; disasterWarningData = null;
                
                if (!chatbotResponse) {
                    chatbotResponse = [
                        "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.",
                        "* **Ø®Ø·Ø£:** ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ù…ÙØ§ØªÙŠØ­ API."
                    ];
                }
            } finally {
                loading = false;
                render();
            }
        };

        // *****************************************************************
        // 7. Ù…Ù†Ø·Ù‚ ÙˆÙ…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ù„ÙˆÙ„ (Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±)
        // *****************************************************************
        const getSolutions = () => {
            const resources = getGovernorateResources(selectedCountry, selectedCity);
            const treeData = treeCoverageData;
            const aqi = airQualityData?.data?.aqi ?? 0;

            // --- 1. Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ ---
            let greenSolutions = { title: "Ø­Ù„ÙˆÙ„ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±Ù‚Ø¹Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡", icon: IconMap.Tree, color: "text-green-400", proposals: [] };
            if (treeData.percentage < 10) greenSolutions.proposals.push({ title: "Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø²Ø±Ø§Ø¹Ø© Ø¹Ø§Ø¬Ù„Ø©", details: "ØªÙ†ÙÙŠØ° Ø­Ù…Ù„Ø§Øª ØªØ´Ø¬ÙŠØ± ÙˆØ§Ø³Ø¹Ø© Ø§Ù„Ù†Ø·Ø§Ù‚ ÙÙŠ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø³ÙƒÙ†ÙŠØ© ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©.", icon: IconMap.Alert });
            if (resources.type.includes('urban')) greenSolutions.proposals.push({ title: "Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø±Ø£Ø³ÙŠØ© ÙˆØ£Ø³Ø·Ø­ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡", details: "Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø·Ø­ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯Ø§Ø¦Ù‚ Ø±Ø£Ø³ÙŠØ©ØŒ Ù…Ù…Ø§ ÙŠØ³Ø§Ù‡Ù… ÙÙŠ Ø®ÙØ¶ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØªÙ†Ù‚ÙŠØ© Ø§Ù„Ù‡ÙˆØ§Ø¡.", icon: IconMap.Tree });
            if (resources.type.includes('desert')) greenSolutions.proposals.push({ title: "Ø²Ø±Ø§Ø¹Ø© Ù†Ø¨Ø§ØªØ§Øª Ù…Ø­Ù„ÙŠØ© Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ø¬ÙØ§Ù", details: "Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø²Ø±Ø§Ø¹Ø© Ø£Ø´Ø¬Ø§Ø± Ù…Ø«Ù„ Ø§Ù„Ù†ÙŠÙ… ÙˆØ§Ù„Ø£ÙƒØ§Ø³ÙŠØ§ØŒ Ø§Ù„ØªÙŠ ØªØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„ØµØ­Ø±Ø§ÙˆÙŠØ©.", icon: IconMap.Droplet });
            else greenSolutions.proposals.push({ title: "Ø§Ù‚ØªØ±Ø§Ø­ Ù†Ø¨Ø§ØªØ§Øª Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¦Ø©", details: "Ø²Ø±Ø§Ø¹Ø© Ø£Ø´Ø¬Ø§Ø± Ù…Ø«Ù…Ø±Ø© ÙˆÙ…Ø­Ù„ÙŠØ© Ù…Ø«Ù„ Ø§Ù„Ø¬Ù…ÙŠØ² ÙˆØ§Ù„ØªÙˆØªØŒ ÙˆØ§Ù„ØªÙŠ ØªÙˆÙØ± Ø¸Ù„Ø§Ù‹ ÙˆØºØ°Ø§Ø¡Ù‹.", icon: IconMap.Tree });
            
            // --- 2. Ø­Ù„ÙˆÙ„ ØªÙ„ÙˆØ« Ø§Ù„Ù‡ÙˆØ§Ø¡ ---
            let pollutionSolutions = { title: "Ø­Ù„ÙˆÙ„ Ù„Ù…ÙˆØ§Ø¬Ù‡Ø© ØªÙ„ÙˆØ« Ø§Ù„Ù‡ÙˆØ§Ø¡", icon: IconMap.AirLarge, color: "text-purple-400", proposals: [] };
            if (aqi > 100) {
                pollutionSolutions.proposals.push({ title: "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø§Ø·Ù‚ Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª (LEZ)", details: "Ù…Ù†Ø¹ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ§Ù„Ø£ÙƒØ«Ø± ØªÙ„ÙˆÙŠØ«Ù‹Ø§ Ù„Ù…Ù†Ø§Ø·Ù‚ Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù…Ø¹ ØªØ´Ø¬ÙŠØ¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©.", icon: IconMap.Wind });
                pollutionSolutions.proposals.push({ title: "Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙˆØ±", details: "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªØ¹Ø¯ÙŠÙ„ ØªÙˆÙ‚ÙŠØª Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª.", icon: IconMap.Satellite });
            }
            if (resources.type.includes('nile_delta')) pollutionSolutions.proposals.push({ title: "Ù…ÙƒØ§ÙØ­Ø© Ø­Ø±Ù‚ Ù‚Ø´ Ø§Ù„Ø£Ø±Ø²", details: "ØªÙˆÙÙŠØ± Ù…Ø¹Ø¯Ø§Øª Ù„Ù„Ù…Ø²Ø§Ø±Ø¹ÙŠÙ† Ù„ØªØ­ÙˆÙŠÙ„ Ù‚Ø´ Ø§Ù„Ø£Ø±Ø² Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ø§Ù ÙˆØ£Ø³Ù…Ø¯Ø© Ø¹Ø¶ÙˆÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø­Ø±Ù‚Ù‡.", icon: IconMap.AlertTriangle });
            if (pollutionSolutions.proposals.length === 0) pollutionSolutions.proposals.push({ title: "Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡", details: "Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¬ÙŠØ¯Ø©ØŒ ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ©.", icon: IconMap.Wind });
            
            // --- 3. Ø­Ù„ÙˆÙ„ Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª ---
            let energySolutions = { title: "Ø­Ù„ÙˆÙ„ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø·Ø§Ù‚Ø©", icon: IconMap.Sun, color: "text-amber-400", proposals: [] };
            if (resources.resources.includes('Ø³Ø·ÙˆØ¹ Ø´Ù…Ø³ÙŠ Ø¹Ø§Ù„Ù')) energySolutions.proposals.push({ title: "ØªÙˆØ³Ø¹ ÙÙŠ Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©", details: `Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø³Ø·ÙˆØ¹ Ø§Ù„Ø´Ù…Ø³ÙŠ Ø§Ù„Ø¹Ø§Ù„ÙŠ ÙÙŠ ${selectedCity} Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø·Ø§Øª Ø·Ø§Ù‚Ø© Ø´Ù…Ø³ÙŠØ© ÙƒØ¨Ø±Ù‰.`, icon: IconMap.Sun });
            if (resources.type.includes('coastal')) energySolutions.proposals.push({ title: "Ù…Ø´Ø§Ø±ÙŠØ¹ Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø­ Ø§Ù„Ø¨Ø­Ø±ÙŠØ©", details: "Ø¨Ù†Ø§Ø¡ Ù…Ø²Ø§Ø±Ø¹ Ø±ÙŠØ§Ø­ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ø§Ù„Ø³Ø§Ø­Ù„ Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø³Ø±Ø¹Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø­ Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©.", icon: IconMap.WindHigh });
            energySolutions.proposals.push({ title: "Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ Ø¨Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©", details: "Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø£Ø®Ø±Ù‰ ØªØ¹Ù…Ù„ Ø¨Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© ÙˆÙ…ØµØ§Ø¨ÙŠØ­ LED Ø°ÙƒÙŠØ©.", icon: IconMap.Location });
            if (resources.type.includes('coastal') || resources.type.includes('nile')) energySolutions.proposals.push({ title: "Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù†Ù‡Ø±ÙŠ/Ø§Ù„Ø¨Ø­Ø±ÙŠ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ", details: "ØªØ´ØºÙŠÙ„ Ø¹Ø¨Ù‘Ø§Ø±Ø§Øª ÙˆÙ‚ÙˆØ§Ø±Ø¨ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ØµØºÙŠØ±Ø© ÙƒÙˆØ³ÙŠÙ„Ø© Ù†Ù‚Ù„ Ø¹Ø§Ù…Ø© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±Ù‚.", icon: IconMap.Wind });
            
            // --- 4. Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ - Ø§Ù„Ø¨ÙŠØ¦ÙŠ
            const ecoAnalysis = getEconomicEnvironmentalAnalysis();
            const economicEnvironmentalCard = {
                title: "ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ - Ø§Ù„Ø¨ÙŠØ¦ÙŠ",
                details: ecoAnalysis.analysis,
                icon: IconMap.Economy,
                color: ecoAnalysis.color,
                isEcoCard: true 
            };

            // --- 5. Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© (ØªØ³ØªØ®Ø¯Ù… Ø±Ø¯ Ø§Ù„Ù€ API Ø§Ù„Ù…Ø®Ø²Ù†)
            const smartSuggestionsCard = {
                title: "ğŸ¤– Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø°ÙƒÙŠØ© (Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)",
                details: chatbotResponse || [LoadingSpinner("Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª...")], 
                icon: IconMap.Satellite
            };

            return [smartSuggestionsCard, economicEnvironmentalCard, greenSolutions, pollutionSolutions, energySolutions];
        };
        
        // *****************************************************************
        // 8. Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (Rendering Logic)
        // *****************************************************************

        function renderGameCard() {
            const totalCo2Removed = (treesPlanted * CO2_PER_TREE_KG).toFixed(1);
            const totalO2Produced = (treesPlanted * O2_PER_TREE_KG).toFixed(1);

            return CardTemplate(
                "ğŸ® Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ´Ø¬ÙŠØ±",
                IconMap.Tree,
                "text-lime-500",
                `
                    <div class="text-center">
                        <p class="text-gray-300 text-sm">ÙƒÙ† Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„ØªØ´Ø¬ÙŠØ± ÙˆØ²Ø±Ø¹ Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹! ğŸŒ±</p>
                        
                        <button id="plant-btn" class="bg-lime-600 hover:bg-lime-700 text-white font-bold px-5 py-2 rounded-lg mt-4 transition duration-300 shadow-md transform hover:scale-[1.02]">
                            ğŸŒ± Ø§Ø²Ø±Ø¹ Ø´Ø¬Ø±Ø© Ø§Ù„Ø¢Ù†
                        </button>
                        
                        <p id="tree-count" class="mt-4 text-3xl font-extrabold text-lime-400">${treesPlanted}</p>
                        <p class="text-sm text-gray-400">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ù…Ø²Ø±ÙˆØ¹Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹)</p>
                        
                        <hr class="border-gray-700 my-4">
                        
                        <div id="environmental-results" class="grid grid-cols-2 gap-4 text-right">
                            <div class="p-2 bg-gray-700/50 rounded-lg">
                                <p class="text-2xl font-bold text-red-400 flex items-center justify-end gap-1">
                                    ${totalCo2Removed} <span class="text-base font-normal text-gray-300">ÙƒØ¬Ù…</span>
                                </p>
                                <p class="text-xs text-gray-400 flex items-center justify-end gap-1">
                                    <span class="w-4 h-4 text-red-500">${IconMap.Co2}</span> $\text{CO}_2$ Ù…Ù…ØªØµ (Ø³Ù†ÙˆÙŠØ§Ù‹)
                                </p>
                            </div>
                            
                            <div class="p-2 bg-gray-700/50 rounded-lg">
                                <p class="text-2xl font-bold text-sky-400 flex items-center justify-end gap-1">
                                    ${totalO2Produced} <span class="text-base font-normal text-gray-300">ÙƒØ¬Ù…</span>
                                </p>
                            <p class="text-xs text-gray-400 flex items-center justify-end gap-1">
                                    <span class="w-4 h-4 text-sky-500">${IconMap.Oxygen}</span> $\text{O}_2$ Ù…Ù†ØªØ¬ (Ø³Ù†ÙˆÙŠØ§Ù‹)
                                </p>
                            </div>
                        </div>

                        <div id="forest" class="mt-3 flex flex-wrap gap-1 justify-center max-h-16 overflow-y-auto pt-2 border-t border-gray-700/50">
                            ${Array(Math.min(treesPlanted, 20)).fill('ğŸŒ³').join('')}
                            ${treesPlanted > 20 ? `<span class="text-xl text-gray-500">+${treesPlanted - 20}</span>` : ''}
                        </div>
                    </div>
                `,
                "col-span-1" 
            );
        }

        function renderCarbonFootprintCard() {
            return CardTemplate(
                "ğŸŒ± Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†ÙŠØ© (Ø´Ø®ØµÙŠØ©)",
                IconMap.AlertTriangle,
                "text-blue-400",
                `
                    <div class="space-y-4">
                        <p class="text-gray-300 text-sm">Ø£Ø¯Ø®Ù„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ø­Ø³Ø§Ø¨ Ø¨ØµÙ…ØªÙƒ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ© (ÙƒØ¬Ù… $\text{CO}_2$).</p>
                        <form id="carbon-form" class="space-y-3 text-sm">
                            <label class="block text-right">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ (ÙƒÙŠÙ„ÙˆÙˆØ§Øª/Ø´Ù‡Ø±): 
                                <input type="number" id="electricity" placeholder="Ù…Ø«Ø§Ù„: 500" />
                            </label>
                            <label class="block text-right">Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª (ÙƒÙ…/Ø´Ù‡Ø±): 
                                <input type="number" id="transport" placeholder="Ù…Ø«Ø§Ù„: 300" />
                            </label>
                            <label class="block text-right">Ø¨Ù„Ø§Ø³ØªÙŠÙƒ (ÙƒØ¬Ù…/Ø´Ù‡Ø±): 
                                <input type="number" id="plastic" placeholder="Ù…Ø«Ø§Ù„: 5" />
                            </label>
                            <button type="submit" class="text-white rounded-lg transition duration-300 shadow-lg">
                                Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¨ØµÙ…Ø© ğŸš€
                            </button>
                        </form>
                        <p id="carbon-result" class="mt-4 text-center text-lg font-bold min-h-[1.5rem]">
                            </p>
                    </div>
                `,
                "col-span-1" 
            );
        }


        const renderHeader = () => `
            <header class="bg-gray-900/90 backdrop-blur-sm sticky top-0 z-10 p-4 border-b border-gray-700 shadow-xl">
                <div class="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
                    <h1 class="text-3xl font-extrabold text-blue-400 flex items-center gap-2">
                        ${IconMap.Satellite} Ù…Ø±ØµØ¯ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ 2025
                    </h1>
                    
                    <div class="flex items-center gap-4 text-sm">
                        <div class="flex items-center gap-2">
                            <label for="country-select" class="text-gray-300 font-semibold">Ø§Ù„Ø¯ÙˆÙ„Ø©:</label>
                            <select id="country-select" class="bg-gray-700 text-white rounded-lg p-2 governorate-btn border border-gray-600 focus:border-blue-400 focus:ring-1 focus:ring-blue-400 transition" 
                                    onchange="handleCountryChange(this.value)">
                                ${Object.keys(globalLocations).map(country => 
                                    `<option value="${country}" ${country === selectedCountry ? 'selected' : ''}>${country}</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <label for="city-select" class="text-gray-300 font-semibold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                            <select id="city-select" class="bg-gray-700 text-white rounded-lg p-2 governorate-btn border border-gray-600 focus:border-blue-400 focus:ring-1 focus:ring-blue-400 transition" 
                                    onchange="handleCityChange(this.value)">
                                ${Object.keys(globalLocations[selectedCountry] || {}).map(city => 
                                    `<option value="${city}" ${city === selectedCity ? 'selected' : ''}>${city}</option>`
                                ).join('')}
                            </select>
                        </div>
                    </div>

                    <nav class="flex space-x-2 space-x-reverse">
                        <button onclick="handleViewChange('dashboard')" class="px-5 py-2 rounded-full font-bold transition duration-300 
                                ${currentView === 'dashboard' ? 'bg-blue-600 text-white shadow-md shadow-blue-500/50' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}">
                            Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ© (Dashboard)
                        </button>
                        <button onclick="handleViewChange('solutions')" class="px-5 py-2 rounded-full font-bold transition duration-300 
                                ${currentView === 'solutions' ? 'bg-blue-600 text-white shadow-md shadow-blue-500/50' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}">
                            Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ©
                        </button>
                    </nav>
                </div>
            </header>
        `;

        // *****************************************************************
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù…Ø­Ø¯Ø«Ø© (renderWeatherCard)
        // *****************************************************************
        const renderWeatherCard = () => {
            const temp = weatherData?.main?.temp ?? 'N/A';
            const description = weatherData?.weather?.[0]?.description ?? 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            const iconCode = weatherData?.weather?.[0]?.icon ?? '50d';
            const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`; 
            const sunrise = formatTime(weatherData?.sys?.sunrise);
            const sunset = formatTime(weatherData?.sys?.sunset);
            const windSpeed = weatherData?.wind?.speed ?? 'N/A';
            const windDirection = weatherData?.wind?.deg ? `(${weatherData.wind.deg}Â°)` : '';
            const humidity = weatherData?.main?.humidity ?? 'N/A';
            const clouds = weatherData?.clouds?.all ?? 'N/A';

            return CardTemplate(
                "Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ",
                IconMap.Thermometer,
                colors.secondaryAccent,
                `
                    <div class="flex items-start justify-between gap-6 pt-3">
                        
                        <div class="text-center flex-grow flex flex-col justify-center items-center">
                            <img src="${iconUrl}" alt="${description}" class="w-24 h-24" style="filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.4));">
                            <p class="text-6xl font-extrabold mt-1 text-white">${Math.round(temp)}Â°C</p>
                            <p class="text-md text-gray-300 font-semibold">${description}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 flex-shrink-0 w-full lg:w-2/3">
                            
                            <div class="weather-detail-box">
                                <span class="w-5 h-5 text-blue-400 mb-1">${IconMap.Droplet}</span> 
                                <p class="text-lg font-bold text-white">${humidity}%</p>
                                <p class="text-xs text-gray-400">Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</p>
                            </div>

                            <div class="weather-detail-box">
                                <span class="w-5 h-5 text-lime-400 wind-icon mb-1">${IconMap.Wind}</span> 
                                <p class="text-lg font-bold text-white">${windSpeed} Ù…/Ø«</p>
                                <p class="text-xs text-gray-400">Ø§Ù„Ø±ÙŠØ§Ø­ ${windDirection}</p>
                            </div>

                            <div class="weather-detail-box">
                                <span class="w-5 h-5 text-gray-400 mb-1">${IconMap.Cloud}</span> 
                                <p class="text-lg font-bold text-white">${clouds}%</p>
                                <p class="text-xs text-gray-400">Ø§Ù„ØºÙŠÙˆÙ…</p>
                            </div>

                            <div class="weather-detail-box">
                                <span class="w-5 h-5 text-amber-400 mb-1">${IconMap.Sun}</span> 
                                <p class="text-lg font-bold text-white">${sunrise}</p>
                                <p class="text-xs text-gray-400">Ø§Ù„Ø´Ø±ÙˆÙ‚</p>
                            </div>
                            
                            <div class="weather-detail-box col-span-2">
                                <span class="w-5 h-5 text-amber-400 mb-1">${IconMap.Sun}</span> 
                                <p class="text-lg font-bold text-white">${sunset}</p>
                                <p class="text-xs text-gray-400">Ø§Ù„ØºØ±ÙˆØ¨</p>
                            </div>
                        </div>
                    </div>
                `,
                "col-span-full md:col-span-2 lg:col-span-2" 
            );
        };
        // *****************************************************************
        // Ù†Ù‡Ø§ÙŠØ© Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù…Ø­Ø¯Ø«Ø© 
        // *****************************************************************

        const renderAirQualityCard = () => {
            const aqi = airQualityData?.data?.aqi ?? null;
            const status = getAqiStatus(aqi);
            const colorClass = getAqiColor(aqi);

            return CardTemplate(
                "Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ (AQI)",
                IconMap.AirLarge,
                colorClass,
                `
                    <div class="text-center pt-3">
                        <p class="text-5xl font-extrabold ${colorClass} mb-4">${aqi ?? 'N/A'}</p>
                        <p class="text-xl font-semibold mb-6">${status}</p>
                        <div class="grid grid-cols-3 gap-2 text-right text-xs pt-3 border-t border-gray-700/50">
                            <div><p class="text-gray-400">PM2.5:</p><p class="text-white font-bold text-sm">${airQualityData?.data?.iaqi?.pm25?.v ?? 'N/A'}</p></div>
                            <div><p class="text-gray-400">NO2:</p><p class="text-white font-bold text-sm">${airQualityData?.data?.iaqi?.no2?.v ?? 'N/A'}</p></div>
                            <div><p class="text-gray-400">O3:</p><p class="text-white font-bold text-sm">${airQualityData?.data?.iaqi?.o3?.v ?? 'N/A'}</p></div>
                        </div>
                    </div>
                `,
                "col-span-1 lg:col-span-1" 
            );
        };
        
        const renderTreeCoverageCard = () => {
            const treeData = treeCoverageData;
            const percentage = treeData?.percentage ?? 0;
            const status = treeData?.status ?? 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            const recommendation = treeData?.recommendation ?? 'Ø¬Ø§Ø±ÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ¶Ø¹.';

            return CardTemplate(
                "Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø´Ø¬Ø±ÙŠØ©",
                IconMap.Tree,
                treeData?.color ?? "text-gray-400",
                `
                    <div class="space-y-4 pt-3">
                        <div class="flex justify-between items-center">
                            <span class="text-5xl font-extrabold ${treeData?.color ?? "text-gray-400"}">${percentage}%</span>
                            <span class="text-xl font-semibold">${status}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div class="h-3 rounded-full ${treeData?.barColor ?? "bg-gray-500"}" style="width: ${percentage}%;"></div>
                        </div>
                        <p class="text-sm text-gray-400 mt-2 border-r-4 border-lime-400 pr-2">${recommendation}</p>
                    </div>
                `,
                "col-span-1 lg:col-span-1" 
            );
        };

        const renderHealthRiskCard = () => {
            const risk = healthRiskData;
            const percentage = risk?.percentage ?? 0;
            const status = risk?.status ?? 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            const recommendation = risk?.recommendation ?? 'Ø¬Ø§Ø±ÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±.';

            return CardTemplate(
                "Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØµØ­ÙŠØ©",
                IconMap.Alert,
                risk?.color ?? "text-gray-400",
                `
                    <div class="space-y-4 pt-3">
                        <div class="flex justify-between items-center pb-2">
                            <span class="text-5xl font-extrabold ${risk?.color ?? "text-gray-400"}">${percentage}%</span>
                            <span class="text-xl font-semibold">${status}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div class="h-3 rounded-full ${risk?.barColor ?? "bg-gray-500"}" style="width: ${percentage}%;"></div>
                        </div>
                        <p class="text-sm text-gray-400 border-r-4 border-blue-400 pr-2 pt-2">${recommendation}</p>
                        
                        <div class="grid grid-cols-3 gap-4 text-sm pt-4 border-t border-gray-700/50">
                            <div class="text-center"><p class="font-bold text-gray-300">Ø§Ù„ØªÙ†ÙØ³:</p><p class="${risk?.healthDetails?.respiratory?.color} text-base">${risk?.healthDetails?.respiratory?.level}</p></div>
                            <div class="text-center"><p class="font-bold text-gray-300">Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</p><p class="${risk?.healthDetails?.heatStress?.color} text-base">${risk?.healthDetails?.heatStress?.level}</p></div>
                            <div class="text-center"><p class="font-bold text-gray-300">Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©:</p><p class="${risk?.healthDetails?.allergy?.color} text-base">${risk?.healthDetails?.allergy?.level}</p></div>
                        </div>
                    </div>
                `,
                "col-span-full md:col-span-2 lg:col-span-2"
            );
        };

        const renderDisasterWarningCard = () => {
            const warnings = disasterWarningData || [];
            if (warnings.length === 0) {
                return CardTemplate(
                    "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ÙƒÙˆØ§Ø±Ø«",
                    IconMap.AlertTriangle,
                    "text-green-500",
                    `<p class="text-lg font-bold text-center text-green-400 mt-4">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø·Ø§Ø±Ø¦Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`,
                    "col-span-full"
                );
            }
            
            const content = warnings.map(w => `
                <div class="flex items-start gap-4 p-3 bg-gray-700/50 rounded-lg border-r-4 border-current hover:bg-gray-700 transition duration-150" style="border-color: ${w.iconColor.replace('text-', '').replace('500', '600')}">
                    <span class="flex-shrink-0 w-6 h-6 ${w.iconColor}">${IconMap.Alert}</span>
                    <div>
                        <p class="font-bold text-white text-sm">${w.type}</p>
                        <p class="text-xs text-gray-300">${w.message}</p>
                    </div>
                </div>
            `).join('');

            return CardTemplate(
                "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ÙƒÙˆØ§Ø±Ø«",
                IconMap.AlertTriangle,
                "text-red-500",
                `<div class="space-y-3 pt-3">${content}</div>`,
                "col-span-full"
            );
        };
        
        // *****************************************************************
        // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ ØªØ±ØªÙŠØ¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù‡Ù†Ø§ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„ÙŠØ¯ÙˆÙŠ
        // *****************************************************************
        const renderDashboardView = () => `
            <main class="max-w-7xl mx-auto p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    
                    ${renderWeatherCard()} 
                    ${renderTreeCoverageCard()}
                    ${renderAirQualityCard()}
                    
                    ${renderHealthRiskCard()} 
                    
                    ${renderDisasterWarningCard()} 

                </div>
            </main>
        `;

        // *** Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù„ÙˆÙ„ (Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±) ***
        const renderSolutionCard = (solution, span = "col-span-1") => {
            let contentHtml;
            if (solution.isEcoCard) {
                // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ-Ø§Ù„Ø¨ÙŠØ¦ÙŠ
                contentHtml = solution.details.map(p => `
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 text-yellow-400 flex-shrink-0">${p.icon}</div>
                        <div class="text-right">
                            <p class="font-bold text-sm text-white">${p.title}</p>
                            <p class="text-xs text-gray-400 border-r border-gray-600 pr-2">${p.details}</p>
                        </div>
                    </div>
                `).join('<hr class="border-gray-700 my-4">');
            } else if (solution.title.includes("Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø°ÙƒÙŠØ©")) {
                // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø©
                
                // 1. Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                let analysisHtml = loading && !chatbotResponse
                    ? LoadingSpinner("Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª...")
                    : solution.details.map(line => 
                        line.startsWith('*') 
                        ? `<p class="text-gray-200 font-semibold text-sm flex items-start gap-1"><span class="text-blue-400 text-lg ml-2">â€¢</span>${line.substring(1).trim()}</p>`
                        : `<p class="text-white font-normal text-base">${line}</p>`
                    ).join('<div class="h-2"></div>');

                // 2. Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                let chatHistoryHtml = chatHistory.map(msg => `
                    <div class="flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} mb-2">
                        <div class="${msg.role === 'user' ? 'user-message' : 'ai-message'} text-sm">${msg.text}</div>
                    </div>
                `).join('');

                // 3. Ø¯Ù…Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                contentHtml = `
                    <h4 class="text-lg font-bold text-blue-400 mb-3">Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ù„Ù…Ø±ØµØ¯:</h4>
                    <div class="space-y-4 pr-3 border-r-2 border-blue-400/50 pb-4">
                        ${analysisHtml}
                    </div>

                    <h4 class="text-lg font-bold text-blue-400 mt-6 mb-3 border-t border-gray-700 pt-4">ğŸ¤– Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„Ø®Ø¨ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ:</h4>
                    
                    <div id="chat-history" class="h-64 overflow-y-auto mb-4">${chatHistoryHtml}</div>

                    <form id="chat-form" class="flex gap-2" onsubmit="handleChatSubmit(event)">
                        <input type="text" id="chat-input" placeholder="Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ø­ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ù‡Ù†Ø§..." required class="flex-grow text-sm"/>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex-shrink-0">
                            Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </form>
                `;

            } else {
                // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ© (Ø§Ù„Ù‡ÙˆØ§Ø¡ØŒ Ø§Ù„Ø·Ø§Ù‚Ø©ØŒ Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡)
                contentHtml = solution.proposals.map(p => `
                    <div class="flex items-start gap-3">
                        <div class="w-5 h-5 text-lime-400 flex-shrink-0">${p.icon}</div>
                        <div class="text-right">
                            <p class="font-bold text-sm text-white">${p.title}</p>
                            <p class="text-xs text-gray-400">${p.details}</p>
                        </div>
                    </div>
                `).join('<hr class="border-gray-700 my-4">');
            }


            return `
                <div class="solution-card rounded-2xl p-6 shadow-2xl space-y-4 transition duration-300 hover:shadow-blue-500/20 ${span}">
                    <div class="flex items-center gap-3 border-b border-gray-700/50 pb-3">
                        <div class="w-7 h-7 ${solution.color}">${solution.icon}</div>
                        <h3 class="text-xl font-bold text-white">${solution.title}</h3>
                    </div>
                    <div>
                        ${contentHtml}
                    </div>
                </div>
            `;
        };
        // *** Ù†Ù‡Ø§ÙŠØ© Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù„ÙˆÙ„ ***

        const renderSolutionsView = () => {
            const solutions = getSolutions();
            const smartCard = solutions[0];
            const economicCard = solutions[1];
            const otherSolutions = solutions.slice(2);

            return `
                <main class="max-w-7xl mx-auto p-6">
                    <h2 class="text-4xl font-extrabold text-white mb-6">Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù€: <span class="text-blue-400">${selectedCity}, ${selectedCountry}</span></h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        ${renderSolutionCard(smartCard, "col-span-1")}
                        ${renderSolutionCard(economicCard, "col-span-1")}
                    </div>
                    
                    <h3 class="text-3xl font-bold text-gray-300 mb-6 border-b border-gray-700/70 pb-3">2. Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§</h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        ${otherSolutions.map(s => renderSolutionCard(s, "col-span-1")).join('')}
                    </div>
                    
                    <h3 class="text-3xl font-bold text-gray-300 mb-6 border-b border-gray-700/70 pb-3">3. Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${renderGameCard()} 
                        ${renderCarbonFootprintCard()}
                    </div>
                </main>
            `;
        };
        
        const render = () => {
            const appContainer = document.getElementById('app-container');
            let content = renderHeader();
            
            if (currentView === 'dashboard') {
                content += renderDashboardView();
            } else {
                content += renderSolutionsView();
            }

            appContainer.innerHTML = content;

            // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø· Ù…Ø¹Ø§Ù„Ø¬ Ø­Ø¯Ø« Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… DOM
            const carbonForm = document.getElementById("carbon-form");
            if (carbonForm) {
                 carbonForm.addEventListener("submit", handleCarbonFormSubmit);
            }
            
            // ØªÙ…Ø±ÙŠØ± scrollDown Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©
            if (currentView === 'solutions') {
                const chatHistoryElement = document.getElementById('chat-history');
                if (chatHistoryElement) {
                    chatHistoryElement.scrollTop = chatHistoryElement.scrollHeight;
                }
            }
        };
        
        // *****************************************************************
        // 9. Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event Handlers)
        // *****************************************************************
        
        const handleCountryChange = (newCountry) => {
            if (newCountry !== selectedCountry) {
                selectedCountry = newCountry;
                
                const firstCity = Object.keys(globalLocations[newCountry])[0];
                selectedCity = firstCity;
                
                currentView = 'dashboard';
                fetchData();
            }
        };

        const handleCityChange = (newCity) => {
            if (newCity !== selectedCity) {
                selectedCity = newCity;
                currentView = 'dashboard';
                fetchData();
            }
        };
        const handleViewChange = (view) => {
            currentView = view;
            render();
        };

        // *** Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ***
        const handleChatSubmit = async (e) => {
            e.preventDefault();
            const chatInput = document.getElementById('chat-input');
            const userMessage = chatInput.value.trim();

            if (!userMessage) return;
            
            // 1. Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            chatHistory.push({ role: 'user', text: userMessage });
            chatHistory.push({ role: 'ai', text: '... Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ' });
            chatInput.value = '';
            render();

            // 2. ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            const aiResponseLines = await generateAiResponse(userMessage, true);
            const aiResponse = aiResponseLines.join(' ');
            
            // 3. ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„Ø±Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            chatHistory.pop(); // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            chatHistory.push({ role: 'ai', text: aiResponse });
            render();
        };

        // *** Ù…Ø¹Ø§Ù„Ø¬ Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø²Ø±Ø§Ø¹Ø© ***
        document.addEventListener("click", (e) => {
            if (e.target.id === "plant-btn") {
                treesPlanted++;
                
                const treeCountElement = document.getElementById("tree-count");
                const forestElement = document.getElementById("forest");
                const resultsContainer = document.getElementById("environmental-results");

                if (treeCountElement) {
                    treeCountElement.textContent = treesPlanted;
                }
                
                if (resultsContainer) {
                    const totalCo2Removed = (treesPlanted * CO2_PER_TREE_KG).toFixed(1);
                    const totalO2Produced = (treesPlanted * O2_PER_TREE_KG).toFixed(1);

                    resultsContainer.innerHTML = `
                        <div class="p-2 bg-gray-700/50 rounded-lg">
                            <p class="text-2xl font-bold text-red-400 flex items-center justify-end gap-1">
                                ${totalCo2Removed} <span class="text-base font-normal text-gray-300">ÙƒØ¬Ù…</span>
                            </p>
                            <p class="text-xs text-gray-400 flex items-center justify-end gap-1">
                                <span class="w-4 h-4 text-red-500">${IconMap.Co2}</span> $\text{CO}_2$ Ù…Ù…ØªØµ (Ø³Ù†ÙˆÙŠØ§Ù‹)
                            </p>
                        </div>
                        
                        <div class="p-2 bg-gray-700/50 rounded-lg">
                            <p class="text-2xl font-bold text-sky-400 flex items-center justify-end gap-1">
                                ${totalO2Produced} <span class="text-base font-normal text-gray-300">ÙƒØ¬Ù…</span>
                            </p>
                            <p class="text-xs text-gray-400 flex items-center justify-end gap-1">
                                <span class="w-4 h-4 text-sky-500">${IconMap.Oxygen}</span> $\text{O}_2$ Ù…Ù†ØªØ¬ (Ø³Ù†ÙˆÙŠØ§Ù‹)
                            </p>
                        </div>
                    `;
                }

                if (forestElement) {
                    const tree = document.createElement("span");
                    tree.textContent = "ğŸŒ³";
                    tree.className = "text-xl transition duration-500 transform hover:scale-125";
                    
                    forestElement.prepend(tree); 
                    
                    while (forestElement.children.length > 20) {
                        forestElement.removeChild(forestElement.lastChild);
                    }
                }
            }
        });
        
        // *** Ù…Ø¹Ø§Ù„Ø¬ Ø­Ø¯Ø« Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†ÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø¬ ***
        const handleCarbonFormSubmit = (e) => {
            e.preventDefault();
                
            const electricityInput = document.getElementById("electricity");
            const transportInput = document.getElementById("transport");
            const plasticInput = document.getElementById("plastic");
            const resultElement = document.getElementById("carbon-result");

            if (!electricityInput || !transportInput || !plasticInput || !resultElement) return;

            const electricity = +electricityInput.value || 0;
            const transport = +transportInput.value || 0;
            const plastic = +plasticInput.value || 0;

            const footprint = electricity * 0.5 + transport * 0.2 + plastic * 2;
                
            let resultMessage;
            let resultColorClass;
                
            if (footprint > 500) {
                resultMessage = `Ø¨ØµÙ…ØªÙƒ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©: ${footprint.toFixed(1)} ÙƒØ¬Ù… $\text{CO}_2$/Ø´Ù‡Ø± ğŸ”´ (Ù…Ø±ØªÙØ¹Ø© Ø¬Ø¯Ø§Ù‹!)`;
                resultColorClass = "text-red-500";
            } else if (footprint > 200) {
                resultMessage = `Ø¨ØµÙ…ØªÙƒ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©: ${footprint.toFixed(1)} ÙƒØ¬Ù… $\text{CO}_2$/Ø´Ù‡Ø± ğŸŸ¡ (Ù…ØªÙˆØ³Ø·Ø©)`;
                resultColorClass = "text-amber-400";
            } else {
                resultMessage = `Ø¨ØµÙ…ØªÙƒ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©: ${footprint.toFixed(1)} ÙƒØ¬Ù… $\text{CO}_2$/Ø´Ù‡Ø± ğŸŸ¢ (Ù…Ù†Ø®ÙØ¶Ø©)`;
                resultColorClass = "text-green-400";
            }

            resultElement.innerHTML = resultMessage;
            resultElement.className = `mt-4 text-center text-lg font-bold ${resultColorClass}`;
        };

        // *****************************************************************
        // 10. Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø£ÙˆÙ„ÙŠ (Initialisation)
        // *****************************************************************
        
        // *****************************************************************
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯ÙˆØ§Ù„ globally Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† HTML
        // *****************************************************************
        window.handleCountryChange = handleCountryChange;
        window.handleCityChange = handleCityChange;
        window.handleViewChange = handleViewChange;
        window.handleChatSubmit = handleChatSubmit;


        fetchData();
    </script>
</body>
</html>
